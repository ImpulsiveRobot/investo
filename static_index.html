<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Investment Time Value Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Inline the modern CSS for GitHub Pages compatibility */
        body {
            font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
            margin: 0;
            background: linear-gradient(120deg, #e0eafc 0%, #cfdef3 100%);
            color: #222;
            min-height: 100vh;
        }
        h1 {
            color: #1a365d;
            text-align: center;
            margin-top: 40px;
            margin-bottom: 24px;
            font-weight: 700;
            letter-spacing: 1px;
        }
        .container {
            background: #fff;
            max-width: 520px;
            margin: 32px auto 0 auto;
            border-radius: 16px;
            box-shadow: 0 6px 32px rgba(44, 62, 80, 0.10), 0 1.5px 6px rgba(44, 62, 80, 0.06);
            padding: 32px 32px 24px 32px;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        label {
            display: flex;
            flex-direction: column;
            font-size: 1.05em;
            color: #1a365d;
            font-weight: 500;
            margin-bottom: 0;
        }
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 10px 12px;
            margin-top: 6px;
            border: 1px solid #cfd8dc;
            border-radius: 6px;
            font-size: 1em;
            background: #f7fafc;
            transition: border 0.2s;
        }
        input[type="text"]:focus, input[type="number"]:focus {
            border: 1.5px solid #4f8cff;
            outline: none;
            background: #fff;
        }
        button {
            background: linear-gradient(90deg, #4f8cff 0%, #38b6ff 100%);
            color: #fff;
            border: none;
            padding: 12px 0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            margin-top: 10px;
            box-shadow: 0 2px 8px rgba(44, 62, 80, 0.07);
            transition: background 0.2s, box-shadow 0.2s;
        }
        button:hover {
            background: linear-gradient(90deg, #38b6ff 0%, #4f8cff 100%);
            box-shadow: 0 4px 16px rgba(44, 62, 80, 0.13);
        }
        table {
            border-collapse: collapse;
            width: 100%;
            background: #fff;
            margin-top: 32px;
            box-shadow: 0 2px 8px rgba(44, 62, 80, 0.07);
            border-radius: 10px;
            overflow: hidden;
        }
        th, td {
            border: none;
            padding: 12px 16px;
            text-align: right;
            font-size: 1.05em;
        }
        th {
            background: linear-gradient(90deg, #4f8cff 0%, #38b6ff 100%);
            color: #fff;
            text-align: center;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        tr:nth-child(even) {
            background: #f4f8fb;
        }
        tr:hover {
            background: #e0eafc;
        }
        @media (max-width: 600px) {
            .container {
                padding: 16px 4vw 12px 4vw;
                max-width: 98vw;
            }
            table, th, td {
                font-size: 0.97em;
            }
        }
    </style>
</head>
<body>
    <h1>Investment Time Value Calculator</h1>
    <div class="container">
        <form id="investment-form" autocomplete="off">
            <label>Initial Investment ($):
                <input type="text" id="initial_investment" required>
            </label>
            <label>Expected Annual Rate of Return (%):
                <input type="number" step="0.01" id="rate_of_return" required>
            </label>
            <label>Monthly Withdrawal ($):
                <input type="text" id="monthly_withdrawal" required>
            </label>
            <label>Annual % Increase in Withdrawals:
                <input type="number" step="0.01" id="annual_increase" required>
            </label>
            <label>Withdrawal Start Year:
                <input type="number" min="1" id="withdrawal_start_year" required>
            </label>
            <label>Investment Duration (years):
                <input type="number" id="years" required>
            </label>
            <button type="submit">Calculate</button>
        </form>
        <div id="results"></div>
        <canvas id="chart" width="400" height="180" style="margin-bottom:32px; display:none;"></canvas>
    </div>
    <script>
    function formatNumberInput(input) {
        let value = input.value.replace(/,/g, '');
        if (!isNaN(value) && value !== "") {
            let parts = value.split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            input.value = parts.join('.');
        }
    }
    document.addEventListener("DOMContentLoaded", function() {
        ["initial_investment", "monthly_withdrawal"].forEach(function(id) {
            let el = document.getElementById(id);
            if (el) {
                el.addEventListener("input", function() { formatNumberInput(el); });
            }
        });

        document.getElementById("investment-form").addEventListener("submit", function(e) {
            e.preventDefault();
            // Get and parse inputs
            function parseNum(id) {
                return parseFloat(document.getElementById(id).value.replace(/,/g, "")) || 0;
            }
            const initial_investment = parseNum("initial_investment");
            const rate_of_return = parseNum("rate_of_return") / 100;
            const monthly_withdrawal = parseNum("monthly_withdrawal");
            const annual_increase = parseNum("annual_increase") / 100;
            const years = parseInt(document.getElementById("years").value) || 0;
            const withdrawal_start_year = parseInt(document.getElementById("withdrawal_start_year").value) || 1;

            let current_value = initial_investment;
            let no_withdrawal_value = initial_investment;
            let investment_values = [];
            for (let year = 1; year <= years; year++) {
                let withdrawal, annual_withdrawal;
                if (year >= withdrawal_start_year) {
                    let years_since_start = year - withdrawal_start_year;
                    withdrawal = monthly_withdrawal * Math.pow(1 + annual_increase, years_since_start);
                    annual_withdrawal = withdrawal * 12;
                } else {
                    withdrawal = 0;
                    annual_withdrawal = 0;
                }
                for (let month = 1; month <= 12; month++) {
                    if (year >= withdrawal_start_year) {
                        current_value = Math.max(current_value - withdrawal, 0);
                    }
                    current_value = current_value * (1 + rate_of_return / 12);
                    no_withdrawal_value = no_withdrawal_value * (1 + rate_of_return / 12);
                }
                investment_values.push({
                    year: year,
                    value: Math.round(current_value * 100) / 100,
                    annual_withdrawal: Math.round(annual_withdrawal * 100) / 100,
                    no_withdrawal_value: Math.round(no_withdrawal_value * 100) / 100
                });
            }

            // Render table
            let html = '';
            if (investment_values.length > 0) {
                html += `<h2 style="margin-top:32px;">Investment Value Over Time</h2>`;
                html += `<table><tr>
                    <th>Year</th>
                    <th>Annual Withdrawal ($)</th>
                    <th>End Balance ($)</th>
                    <th>No Withdrawals ($)</th>
                </tr>`;
                investment_values.forEach(row => {
                    html += `<tr>
                        <td>${row.year}</td>
                        <td>${row.annual_withdrawal.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}</td>
                        <td>${row.value.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}</td>
                        <td>${row.no_withdrawal_value.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}</td>
                    </tr>`;
                });
                html += `</table>`;
            }
            document.getElementById("results").innerHTML = html;

            // Render chart
            const yearsArr = investment_values.map(row => row.year);
            const balances = investment_values.map(row => row.value);
            const withdrawals = investment_values.map(row => row.annual_withdrawal);
            const noWithdrawals = investment_values.map(row => row.no_withdrawal_value);

            const chartEl = document.getElementById('chart');
            chartEl.style.display = "block";
            if (window.investmentChart) window.investmentChart.destroy();
            window.investmentChart = new Chart(chartEl.getContext('2d'), {
                type: 'line',
                data: {
                    labels: yearsArr,
                    datasets: [
                        {
                            label: 'End Balance',
                            data: balances,
                            borderColor: '#4f8cff',
                            backgroundColor: 'rgba(79,140,255,0.08)',
                            fill: true,
                            tension: 0.2,
                            pointRadius: 3
                        },
                        {
                            label: 'Annual Withdrawal',
                            data: withdrawals,
                            borderColor: '#38b6ff',
                            backgroundColor: 'rgba(56,182,255,0.08)',
                            fill: true,
                            tension: 0.2,
                            pointRadius: 3
                        },
                        {
                            label: 'No Withdrawals',
                            data: noWithdrawals,
                            borderColor: '#2ecc40',
                            backgroundColor: 'rgba(46,204,64,0.08)',
                            fill: false,
                            borderDash: [6, 6],
                            tension: 0.2,
                            pointRadius: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('en-US', {minimumFractionDigits: 0});
                                }
                            }
                        }
                    }
                }
            });
        });
    });
    </script>
</body>
</html>
